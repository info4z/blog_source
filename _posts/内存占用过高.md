---
title: 内存占用过高
date: 2020-03-06
tags: 
- 内存
categories:
- 服务器
---



> 服务器内存占用过高, 缓存不释放导致死机,  重启后持续几天再次占满



# 一 : 故障现象

* 服务器内存占用过高, 导致死机
* 服务器硬重启 3-5 天再次占满

# 二 : 问题排查

1. `cpu` 使用率 : `top`
2. 定时任务 `crontab -l`
3. 文件的读取和写入 : `ftp`, `log`

# 三 : 解决方案

## (一) 手动清理

* 可手动清理页文件缓存

  ```shell
  echo 1 > /proc/sys/vm/drop_caches
  ```

## (二) 设置最低剩余内存

* 修改 sysctl.conf 配置文件

  ```shell
  vim /etc/sysctl.conf
  # 最后加入一行
  vm.min_free_kbytes = 2097152
  ```

* 使配置文件生效

  ```shell
  $ sudo sysctl -p
  ```

* 第一种方法直接清空缓存, 可能会造成数据丢失, 我们选用第二种



