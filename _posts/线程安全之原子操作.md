---
title: 线程安全之原子操作
date: 2020-04-10
categories:
- 高性能编程
tags: 
- 多线程并发编程
- 线程安全
---





> 多线程操作共享资源时, 要保证数据的准确就要保证操作的原子性

## 一 : 概述

原子操作操作可以是一个步骤, 也可以是多个操作步骤, 但是其顺序不可以被打乱, 也不可以被切割而只执行其中的一部分(不可中断性); 

**将整个操作视作一个整体是原子性的核心特征**

## 二 : 解决方案

1. 加锁
2. 循环 CAS

## 三 : 示例

示例代码

```java
public class Demo {
    public int i = 0;
    public void incr() {
        i++; 
    }
}
```

这里是三个步骤 : 

1. 加载 i
2. 计算 i+1 
3. 赋值 i

存在**竟态条件**, 线程不安全, 需要转变为原子操作才能安全; 

```java
public synchronized void incr() {
    i++; 
}
```

上例只是针对一个变量的原子操作改进, 我们也可以实现更大逻辑的原子操作